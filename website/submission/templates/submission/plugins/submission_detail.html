{% load sekizai_tags uni_form_tags %}




<div class="submission {{ submission.get_state }}">
	<div class="header stacked">
		<h1>{{ submission.name }}</h1>
		<h2>
			{% if submission.teaser %}
			{{ submission.teaser }} *
			{% endif %}
			<small>{{ submission.date_start|date:"d.m.Y H:i" }} - {{ submission.date_end|date:"d.m.Y H:i" }}</small>
		</h2>
	</div>
	<div class="container">
		<p class="excerpt">
			{{ submission.excerpt }}
		</p>


{% if submission.get_state == 'over' %}
<h4>Einreichung vorbei</h4>
<p>Diese Einreichung ist bereits vorbei.</p>

<div class="entries">
	<h4>Beiträge:</h4>
	
	<ul class="horizontal">
	{% for entry in submission.entry_set.all %}
	
	<li><a href="{{ entry.user.get_absolute_url }}">{{ entry.user }}</a> [<a href="{{ entry.url }}">{{ entry.url }}</a>]</li>
	
	{% endfor %}
	</ul>
	
</div>

{% endif %}

{% if submission.get_state == 'future' %}
<p>Diese Einreichung startet am {{ submission.date_start|date:"d.m.Y H:i" }}. Du kannst deinen Beitrag erst ab diesem Datum eintragen.</p>
{% endif %}

{% if submission.get_state == 'running' and not user_allowed %}
<h1>Sorry - du hast es nicht in diese Runde geschafft</h1>
{% endif %}

{% if submission.get_state == 'running' and user_allowed %}

{% addtoblock "js" %}
<script type="text/javascript">

$('.primaryAction','#submission_{{ submission.id }}').live("click", function(event){
  event.preventDefault();
  
  this.form = $('#submission_{{ submission.id }}');
  
  console.log(this.form);
  
  this.form.submit();
  
});

</script>
{% endaddtoblock %}


<form action="{{ request.get_full_path }}" method="POST" id="submission_{{ submission.id }}" class="uniForm {% if not user.is_authenticated %}disabled{% endif %}">
      {% csrf_token %}
      
      <input type="hidden" name="submission_id" value="{{ submission.id }}" />
      <input type="hidden" name="plugin_type" value="submission" />

      <fieldset class="inlineLabels">
        <h3>Deine Einreichung</h3>
        
        {% if user_entry %}
        <div class="user-entry">
        	<strong>Dein aktueller Beitrag:</strong>
        	<p>[Du kannst diesen noch bis um {{ submission.date_start|date:"d.m.Y H:i" }} ändern]</p>
        	
        	<ul>
        		<li>URL: {{ user_entry.url }}</li>
        		{% if user_entry.description %}
        		<li>Description: {{ user_entry.description }}</li>
        		{% endif %}
        	</ul>
        	
        </div>

		

		{% endif %}
        
        
        {{ form|as_uni_form }}
        
        <!--
        <div class="ctrlHolder">
          <label for=""><em>*</em> URL</label>
          <input {% if not user.is_authenticated %}disabled="disabled"{% endif %} name="url" id="" data-default-value="Placeholder text" size="35" maxlength="50" type="text" class="textInput large"/>
          <p class="formHint">Inklusive http://</p>
        </div>
        
        <div class="ctrlHolder">
          <label for=""><em>*</em> Beschrieb</label>
          <textarea {% if not user.is_authenticated %}disabled="disabled"{% endif %} name="description" id="" rows="12" cols="25"></textarea>
          <p class="formHint">Ein/zwei Sätze zu deiner Einreichung.</p>
        </div>
		-->
		
      </fieldset>

      <div class="buttonHolder">
        <button type="submit" class="secondaryAction">← Cancel and go back</button>
        <button type="submit" {% if not user.is_authenticated %}disabled="disabled"{% endif %} class="primaryAction">Einreichung abschicken</button>
      </div>

    </form>	
    
		
		
	{% if not user.is_authenticated %} 
	{% url acct_login as login_url %}
	{% url acct_signup as signup_url %}
	
	<div class="inline">
		<div class="message login">
			<p>Für die Teilnahme musst du dich: 
				<a href="{{ signup_url }}?next={{ request.path }}">Registrieren</a> 
				und/oder 
				<a href="{{ login_url }}?next={{ request.path }}">Anmelden</a>
			</p>
		</div>
	</div>
	
	{% endif %}
		
		
		
	{% endif %}	
		
		
	</div>
</div>